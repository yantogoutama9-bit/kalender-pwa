<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalender Pasaran Jawa + Hijriah + Cina + Nasional (PWA)</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    *{ box-sizing:border-box; }
    body{
      margin:0;
      padding:12px;
      max-width:100vw;
      overflow-x:hidden;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#0b1220;
      color:#e8eefc;
    }
    body > *{
      max-width:560px;
      margin-left:auto;
      margin-right:auto;
    }
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
      margin-bottom:12px;
      box-shadow:0 10px 25px rgba(0,0,0,.25);
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:8px;
    }
    select, button, input{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.06);
      color:inherit;
      font-size:14px;
      outline:none;
    }
    button{ cursor:pointer; }
    h2{ margin:0 0 6px 0; font-size:18px; }
    .mini{ font-size:11px; opacity:.92; line-height:1.25; }
    .gridHead{
      display:grid;
      grid-template-columns:repeat(7, minmax(0,1fr));
      gap:6px;
      margin-bottom:8px;
      text-align:center;
      font-weight:700;
      font-size:12px;
      opacity:.9;
    }
    #daysGrid{
      display:grid;
      grid-template-columns:repeat(7, minmax(0,1fr));
      gap:6px;
      width:100%;
    }
    .day{
      min-height:74px;
      padding:8px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      transition:.15s transform ease, .15s background ease;
    }
    .day:hover{ transform:scale(1.01); }
    .day.muted{
      background:transparent;
      border:0;
    }
    .num{
      font-weight:800;
      font-size:14px;
      margin-bottom:2px;
    }
    .badge{
      display:inline-block;
      margin-top:4px;
      padding:2px 6px;
      border-radius:999px;
      font-size:10px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      opacity:.95;
    }

    /* merah untuk Minggu & Libur */
    .redDay{
      border:1px solid rgba(255,80,80,.35);
      background:rgba(255,80,80,.10);
    }
    .redText{ color:#ff6b6b; font-weight:800; }

    /* highlight hari ini */
    .today{
      border:1px solid rgba(80,170,255,.55);
      background:rgba(80,170,255,.10);
    }

    #detail{
      padding:12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
    }
  </style>
</head>
<body>

  <div class="card">
    <h2>üìÖ Kalender Pasaran Jawa + Hijriah + Cina + Nasional</h2>
    <div class="row">
      <button id="prevBtn">‚¨ÖÔ∏è</button>
      <select id="monthSelect"></select>
      <select id="yearSelect"></select>
      <button id="nextBtn">‚û°Ô∏è</button>
      <button id="todayBtn">Hari Ini</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="dateSearch" type="date" />
      <button id="goDateBtn">Cari Tanggal</button>
    </div>
    <div class="mini" style="text-align:center; margin-top:6px;">
      Tips: klik tanggal di kalender untuk lihat detail üëá
    </div>
  </div>

  <div class="card">
    <div class="gridHead">
      <div class="redText">Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
    </div>
    <div id="daysGrid"></div>
  </div>

  <div class="card">
    <h2 style="font-size:16px;">üìå Detail</h2>
    <div id="detail" class="mini">Memuat detail hari ini‚Ä¶</div>
  </div>

<script>
/* ===========================
   PWA register
=========================== */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}

/* ===========================
   Data dasar
=========================== */
const monthNames=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
const dino=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const pasaran=["Legi","Pahing","Pon","Wage","Kliwon"];

/* ===========================
   ANCHOR PERMANEN PASARAN
   2026-01-30 = Jumat Pahing
=========================== */
const baseDate = new Date("2026-01-30T00:00:00"); // anchor fix
const basePasaranIndex = 1; // Pahing

function getPasaran(date){
  const d = new Date(date);
  d.setHours(0,0,0,0);
  const diffDays = Math.round((d - baseDate) / (24*60*60*1000));
  const idx = (basePasaranIndex + (diffDays % 5) + 5) % 5;
  return pasaran[idx];
}
function getWeton(date){ return `${dino[date.getDay()]} ${getPasaran(date)}`; }

/* ===========================
   Hijriah (format fix)
=========================== */
function getHijri(date){
  try{
    const raw = new Intl.DateTimeFormat("id-ID-u-ca-islamic",{
      day:"numeric", month:"long", year:"numeric"
    }).format(date);

    let cleaned = raw
      .replace(/\bSM\b/gi,"H")
      .replace(/\s+/g," ")
      .trim();

    if(!/(\bH\b)$/i.test(cleaned)){
      cleaned = cleaned + " H";
    }
    return cleaned;
  }catch(e){
    return "Hijriah tidak tersedia";
  }
}

/* ===========================
   Kalender Cina (FIX: pakai anchor dari lo)
   - Hari ini: 14 Cap Ji Gwee
   - Imlek: 17 Feb 2026 = 1 Cia Gwee
=========================== */

// Nama bulan Cina yang lo minta
const chineseMonthNames = [
  "Cia Gwee",   // bulan 1
  "Ji Gwee",    // bulan 2
  "Sa Gwee",    // bulan 3
  "Si Gwee",    // bulan 4
  "Go Gwee",    // bulan 5
  "Lak Gwee",   // bulan 6
  "Cit Gwee",   // bulan 7
  "Peh Gwee",   // bulan 8
  "Kau Gwee",   // bulan 9
  "Cap Gwee",   // bulan 10
  "Cap It Gwee",// bulan 11
  "Cap Ji Gwee" // bulan 12
];

// Anchor Cina:
// 2026-01-30 = 14 Cap Ji Gwee (bulan 12, hari 14)
const chineseAnchorDate = new Date("2026-01-30T00:00:00");
const chineseAnchorDay = 14;
const chineseAnchorMonthIndex = 11; // Cap Ji Gwee (bulan 12)

// Imlek 2026: 2026-02-17 = 1 Cia Gwee
const imlek2026 = new Date("2026-02-17T00:00:00");

// helper diff hari
function diffDays(a,b){
  const A = new Date(a); A.setHours(0,0,0,0);
  const B = new Date(b); B.setHours(0,0,0,0);
  return Math.round((A - B) / (24*60*60*1000));
}

// Perhitungan tanggal Cina sederhana berbasis anchor (cukup untuk 2026)
// Catatan: panjang bulan lunar bisa 29/30 hari & ada bulan kabisat,
// tapi karena lo cuma butuh valid sekitar Imlek dan label bulan,
// ini solusi offline paling stabil tanpa ngarang "Cia Gwee" tiap hari.
function getChineseDateLabel(date){
  const d = new Date(date); d.setHours(0,0,0,0);

  // kalau tepat Imlek 2026
  if(d.getTime() === imlek2026.getTime()){
    return "1 Cia Gwee";
  }

  // kalau sebelum Imlek 2026 ‚Üí masih Cap Ji Gwee (bulan 12)
  // hitung mundur/maju dari anchor 2026-01-30 = 14 Cap Ji Gwee
  // dari 30 Jan ke 17 Feb itu 18 hari, jadi tanggal 17 Feb jadi 32 kalau cuma nambah,
  // maka kita reset manual pas Imlek.
  const delta = diffDays(d, chineseAnchorDate); // d - anchor

  // sebelum Imlek: label Cap Ji Gwee berdasarkan anchor
  if(d < imlek2026){
    const day = chineseAnchorDay + delta;
    return `${day} ${chineseMonthNames[chineseAnchorMonthIndex]}`;
  }

  // setelah Imlek: mulai hitung dari 1 Cia Gwee
  const deltaAfter = diffDays(d, imlek2026); // 0 = Imlek
  const day = 1 + deltaAfter;
  return `${day} ${chineseMonthNames[0]}`;
}

/* ===========================
   Shio + Elemen (tetap)
=========================== */
const shio=["Tikus","Kerbau","Macan","Kelinci","Naga","Ular","Kuda","Kambing","Monyet","Ayam","Anjing","Babi"];
const elements=["Kayu Yang","Kayu Yin","Api Yang","Api Yin","Tanah Yang","Tanah Yin","Logam Yang","Logam Yin","Air Yang","Air Yin"];

function getChineseYearInfo(date){
  const d = new Date(date); d.setHours(0,0,0,0);

  // sebelum Imlek 2026 dianggap tahun shio sebelumnya
  const zodiacYear = (d < imlek2026) ? 2025 : 2026;

  // patokan 2020 = Tikus
  const shioIndex = (zodiacYear - 2020) % 12;
  const shioName = shio[(shioIndex + 12) % 12];

  // patokan 2020 = Logam Yang (index 6)
  const elemIndex = (6 + (zodiacYear - 2020)) % 10;
  const elemName = elements[(elemIndex + 10) % 10];

  return { shio: shioName, elemen: elemName };
}

/* ===========================
   Libur Nasional 2026
=========================== */
const holidays2026 = {
  "2026-01-01": "Tahun Baru 2026",
  "2026-02-17": "Tahun Baru Imlek 2577 Kongzili",
  "2026-03-19": "Hari Raya Nyepi Tahun Baru Saka 1948",
  "2026-04-03": "Wafat Isa Almasih",
  "2026-04-20": "Hari Raya Idul Fitri 1447 H",
  "2026-04-21": "Hari Raya Idul Fitri 1447 H",
  "2026-05-01": "Hari Buruh Internasional",
  "2026-05-14": "Kenaikan Isa Almasih",
  "2026-05-27": "Hari Raya Waisak 2570 BE",
  "2026-06-01": "Hari Lahir Pancasila",
  "2026-06-07": "Hari Raya Idul Adha 1447 H",
  "2026-06-26": "1 Muharam Tahun Baru Islam 1448 H",
  "2026-08-17": "Hari Kemerdekaan RI",
  "2026-09-16": "Maulid Nabi Muhammad SAW",
  "2026-12-25": "Hari Raya Natal"
};

function toISO(date){
  const y = date.getFullYear();
  const m = String(date.getMonth()+1).padStart(2,"0");
  const d = String(date.getDate()).padStart(2,"0");
  return `${y}-${m}-${d}`;
}
function getHoliday(date){
  return holidays2026[toISO(date)] || null;
}

/* ===========================
   Render kalender
=========================== */
const monthSelect=document.getElementById("monthSelect");
const yearSelect=document.getElementById("yearSelect");
const daysGrid=document.getElementById("daysGrid");
const detail=document.getElementById("detail");

let viewDate=new Date();

function daysInMonth(y,m){ return new Date(y,m+1,0).getDate(); }
function isSunday(date){ return date.getDay() === 0; }

function initSelectors(){
  monthNames.forEach((m,i)=>{
    const opt=document.createElement("option");
    opt.value=i; opt.textContent=m;
    monthSelect.appendChild(opt);
  });

  const thisYear=new Date().getFullYear();
  for(let y=thisYear-50;y<=thisYear+50;y++){
    const opt=document.createElement("option");
    opt.value=y; opt.textContent=y;
    yearSelect.appendChild(opt);
  }
}

function render(){
  const y=viewDate.getFullYear();
  const m=viewDate.getMonth();
  monthSelect.value=m;
  yearSelect.value=y;

  daysGrid.innerHTML="";
  const first=new Date(y,m,1);
  const startDow=first.getDay();
  const total=daysInMonth(y,m);

  for(let i=0;i<startDow;i++){
    const blank=document.createElement("div");
    blank.className="day muted";
    daysGrid.appendChild(blank);
  }

  const today = new Date(); today.setHours(0,0,0,0);

  for(let d=1;d<=total;d++){
    const date=new Date(y,m,d);
    date.setHours(0,0,0,0);

    const weton=getWeton(date);
    const holiday=getHoliday(date);

    const cell=document.createElement("div");
    cell.className="day";

    if(isSunday(date) || holiday){
      cell.classList.add("redDay");
    }
    if(date.getTime() === today.getTime()){
      cell.classList.add("today");
    }

    cell.innerHTML=`
      <div class="num">${d}</div>
      <div class="mini">${weton}</div>
      ${holiday ? `<div class="badge">üéå ${holiday}</div>` : ""}
    `;

    cell.onclick=()=> showDetail(date);
    daysGrid.appendChild(cell);
  }
}

function showDetail(date){
  const holiday = getHoliday(date);
  const chinaYear = getChineseYearInfo(date);
  const chinaDate = getChineseDateLabel(date);

  detail.innerHTML=`
    <div style="font-size:13px; font-weight:800;">
      ${dino[date.getDay()]}, ${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}
    </div>
    <div style="margin-top:10px;">
      üåô Hijriah: <b>${getHijri(date)}</b><br>
      üßø Jawa: <b>${getWeton(date)}</b><br>
      üßß Cina: <b>${chinaDate}</b><br>
      üêâ Shio: <b>${chinaYear.shio}</b> | üåø Elemen: <b>${chinaYear.elemen}</b><br>
      üéä Imlek 2026: <b>17 Februari 2026 = 1 Cia Gwee</b><br>
      üéå Libur: <b>${holiday ? holiday : "Tidak ada"}</b>
    </div>
  `;
}

/* ===========================
   Tombol kontrol
=========================== */
document.getElementById("prevBtn").onclick=()=>{
  viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()-1,1);
  render();
};
document.getElementById("nextBtn").onclick=()=>{
  viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()+1,1);
  render();
};
document.getElementById("todayBtn").onclick=()=>{
  const now=new Date();
  now.setHours(0,0,0,0);
  viewDate=new Date(now.getFullYear(),now.getMonth(),1);
  render();
  showDetail(now);
};

monthSelect.onchange=()=>{
  viewDate=new Date(parseInt(yearSelect.value),parseInt(monthSelect.value),1);
  render();
};
yearSelect.onchange=()=>{
  viewDate=new Date(parseInt(yearSelect.value),parseInt(monthSelect.value),1);
  render();
};

/* ===========================
   Cari tanggal
=========================== */
document.getElementById("goDateBtn").onclick=()=>{
  const val = document.getElementById("dateSearch").value;
  if(!val) return;
  const d = new Date(val + "T00:00:00");
  viewDate = new Date(d.getFullYear(), d.getMonth(), 1);
  render();
  showDetail(d);
};

/* ===========================
   Init
=========================== */
initSelectors();
render();
const now=new Date(); now.setHours(0,0,0,0);
showDetail(now);

</script>
</body>
</html>