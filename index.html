<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalender Lengkap (PWA)</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    *{ box-sizing:border-box; }

    body{
      margin:0;
      padding:12px;
      max-width:100vw;
      overflow-x:hidden;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#0b1220;
      color:#fff;
    }

    body > *{
      max-width:520px;
      margin-left:auto;
      margin-right:auto;
    }

    h2{
      font-size:18px;
      margin:0 0 10px 0;
      text-align:center;
    }

    .card{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
      margin-bottom:12px;
      box-shadow:0 10px 20px rgba(0,0,0,.15);
    }

    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }

    select, button, input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.08);
      color:#fff;
      font-size:14px;
      outline:none;
    }

    input[type="date"]{
      min-width:160px;
    }

    button{ cursor:pointer; }

    /* tombol install */
    #installBtn{
      display:none;
      font-weight:700;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(0,255,180,.18);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(7, minmax(0,1fr));
      gap:6px;
      width:100%;
    }

    #daysGrid{
      display:grid;
      grid-template-columns:repeat(7, minmax(0,1fr));
      gap:6px;
      width:100%;
    }

    .day{
      min-height:66px;
      padding:6px;
      border-radius:12px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      cursor:pointer;
      transition:transform .08s ease;
    }

    .day:active{ transform:scale(.98); }

    .day.muted{
      background:transparent;
      border:0;
      cursor:default;
    }

    .day .num{
      font-weight:800;
      font-size:14px;
      margin-bottom:2px;
    }

    .mini{
      font-size:10px;
      opacity:.9;
      line-height:1.2;
      word-break:break-word;
    }

    /* Highlight hari ini */
    .today{
      border:1px solid rgba(0,255,180,.55);
      background:rgba(0,255,180,.12);
      box-shadow:0 0 0 2px rgba(0,255,180,.12);
    }

    /* Minggu merah */
    .sunday .num{
      color:#ff6b6b;
    }

    /* Libur merah */
    .holiday{
      border:1px solid rgba(255,107,107,.55);
      background:rgba(255,107,107,.10);
    }

    .badge{
      display:inline-block;
      margin-top:2px;
      padding:2px 6px;
      border-radius:999px;
      font-size:9px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
    }

    .badge.holiday{
      background:rgba(255,107,107,.18);
      border:1px solid rgba(255,107,107,.30);
    }

    #detail{
      margin-top:8px;
      padding:12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
    }
  </style>
</head>

<body>

  <div class="card">
    <h2>üìÖ Kalender Pasaran Jawa + Hijriah + Cina + Nasional</h2>

    <div class="row" style="margin-bottom:10px;">
      <button id="prevBtn">‚¨ÖÔ∏è</button>
      <select id="monthSelect"></select>
      <select id="yearSelect"></select>
      <button id="nextBtn">‚û°Ô∏è</button>
      <button id="todayBtn">Hari Ini</button>
    </div>

    <!-- Cari Tanggal -->
    <div class="row" style="margin-bottom:10px;">
      <input type="date" id="datePicker">
      <button id="goDateBtn">üîé Cari</button>
    </div>

    <div class="row">
      <button id="installBtn">üì≤ Install App</button>
    </div>
  </div>

  <div class="card">
    <div class="grid" style="margin-bottom:8px;">
      <div class="mini">Min</div><div class="mini">Sen</div><div class="mini">Sel</div>
      <div class="mini">Rab</div><div class="mini">Kam</div><div class="mini">Jum</div><div class="mini">Sab</div>
    </div>
    <div id="daysGrid"></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0;">üìå Detail</h3>
    <div id="detail" class="mini">Klik tanggal dulu‚Ä¶</div>
  </div>

<script>
  // ===== PWA register =====
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js");
    });
  }

  // ===== Install Button (Android Chrome) =====
  let deferredPrompt = null;
  const installBtn = document.getElementById("installBtn");

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "inline-block";
  });

  installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display = "none";
  });

  // ===== Data dasar =====
  const monthNames=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  const dino=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const pasaran=["Legi","Pahing","Pon","Wage","Kliwon"];

  // ===== Anchor Pasaran (HARI INI dianggap Kamis Legi) =====
  const baseDate = new Date();
  baseDate.setHours(0,0,0,0);
  const basePasaranIndex = 0; // 0=Legi

  // ===== Libur Nasional (tinggal update per tahun) =====
  const holidaysByYear = {
    2026: {
      "01-01": "Tahun Baru Masehi",
      "01-16": "Isra Mikraj",
      "02-17": "Tahun Baru Imlek",
      "03-19": "Hari Raya Nyepi",
      "04-03": "Wafat Isa Almasih",
      "05-01": "Hari Buruh Internasional",
      "05-14": "Kenaikan Isa Almasih",
      "05-28": "Hari Raya Waisak",
      "06-01": "Hari Lahir Pancasila",
      "06-17": "Idul Adha",
      "07-17": "Tahun Baru Islam (1 Muharram)",
      "08-17": "Hari Kemerdekaan RI",
      "09-16": "Maulid Nabi Muhammad SAW",
      "12-25": "Hari Raya Natal"
    }
  };

  function pad2(n){ return String(n).padStart(2,"0"); }
  function isoKey(date){ return `${pad2(date.getMonth()+1)}-${pad2(date.getDate())}`; }

  function getHoliday(date){
    const y = date.getFullYear();
    const key = isoKey(date);
    return (holidaysByYear[y] && holidaysByYear[y][key]) ? holidaysByYear[y][key] : null;
  }

  // ===== Pasaran =====
  function getPasaran(date){
    const d = new Date(date);
    d.setHours(0,0,0,0);
    const diffDays = Math.round((d - baseDate) / (24*60*60*1000));
    const idx = (basePasaranIndex + (diffDays % 5) + 5) % 5;
    return pasaran[idx];
  }

  function getWeton(date){
    return `${dino[date.getDay()]} ${getPasaran(date)}`;
  }

  // ===== Hijriah (fix output jadi "H") =====
  function fixHijriText(txt){
    return txt
      .replace(/\s?SM\b/gi, "")
      .replace(/\s?M\b/gi, "")
      .trim() + " H";
  }

  function getHijri(date){
    try{
      const raw = new Intl.DateTimeFormat("id-ID-u-ca-islamic",{
        day:"numeric",month:"long",year:"numeric"
      }).format(date);

      return fixHijriText(raw);
    }catch(e){
      return "Hijriah tidak tersedia";
    }
  }

  // ===== Imlek (CNY) Table =====
  const cnyByYear = {
    2024: "2024-02-10",
    2025: "2025-01-29",
    2026: "2026-02-17",
    2027: "2027-02-06",
    2028: "2028-01-26",
    2029: "2029-02-13",
    2030: "2030-02-03"
  };

  function getCNYDate(year){
    if (cnyByYear[year]){
      return new Date(cnyByYear[year] + "T00:00:00");
    }
    return new Date(year, 1, 4);
  }

  // ===== Shio + Elemen =====
  const shio=["Tikus","Kerbau","Macan","Kelinci","Naga","Ular","Kuda","Kambing","Monyet","Ayam","Anjing","Babi"];
  const elements=["Kayu Yang","Kayu Yin","Api Yang","Api Yin","Tanah Yang","Tanah Yin","Logam Yang","Logam Yin","Air Yang","Air Yin"];

  function getChineseYearInfo(date){
    const d = new Date(date);
    d.setHours(0,0,0,0);

    const y = d.getFullYear();
    const cny = getCNYDate(y);
    cny.setHours(0,0,0,0);

    const zodiacYear = (d < cny) ? (y - 1) : y;

    const shioIndex = (zodiacYear - 2020) % 12; // 2020 Tikus
    const shioName = shio[(shioIndex + 12) % 12];

    const elemIndex = (6 + (zodiacYear - 2020)) % 10; // 2020 Logam Yang
    const elemName = elements[(elemIndex + 10) % 10];

    return {shio: shioName, elemen: elemName};
  }

  // ===== Tanggalan Cina =====
  const chineseMonthNames = [
    "Cia Gwee", "Jie Gwee", "Sa Gwee", "Si Gwee", "Go Gwee", "Lak Gwee",
    "Cit Gwee", "Pat Gwee", "Kau Gwee", "Cap Gwee", "Cap It Gwee", "Cap Jie Gwee"
  ];

  function daysBetween(a,b){
    const da = new Date(a); da.setHours(0,0,0,0);
    const db = new Date(b); db.setHours(0,0,0,0);
    return Math.round((db - da) / (24*60*60*1000));
  }

  function getChineseDateText(date){
    const d = new Date(date);
    d.setHours(0,0,0,0);

    const y = d.getFullYear();
    const cnyThis = getCNYDate(y);
    cnyThis.setHours(0,0,0,0);

    let cnyBase;
    if (d >= cnyThis){
      cnyBase = cnyThis;
    } else {
      cnyBase = getCNYDate(y - 1);
      cnyBase.setHours(0,0,0,0);
    }

    const dayOffset = daysBetween(cnyBase, d); // 0 = 1 Cia Gwee
    let remaining = dayOffset;

    let monthIndex = 0;
    while (monthIndex < 12){
      const monthLen = (monthIndex % 2 === 0) ? 29 : 30;
      if (remaining < monthLen) break;
      remaining -= monthLen;
      monthIndex++;
    }

    const dayInMonth = remaining + 1;
    const monthName = chineseMonthNames[Math.min(monthIndex, 11)];
    return `${dayInMonth} ${monthName}`;
  }

  // ===== UI =====
  const monthSelect=document.getElementById("monthSelect");
  const yearSelect=document.getElementById("yearSelect");
  const daysGrid=document.getElementById("daysGrid");
  const detail=document.getElementById("detail");

  const datePicker = document.getElementById("datePicker");
  const goDateBtn = document.getElementById("goDateBtn");

  let viewDate=new Date();

  function daysInMonth(y,m){
    return new Date(y,m+1,0).getDate();
  }

  function isSameDate(a,b){
    const da = new Date(a); da.setHours(0,0,0,0);
    const db = new Date(b); db.setHours(0,0,0,0);
    return da.getTime() === db.getTime();
  }

  function initSelectors(){
    monthNames.forEach((m,i)=>{
      const opt=document.createElement("option");
      opt.value=i; opt.textContent=m;
      monthSelect.appendChild(opt);
    });

    const thisYear=new Date().getFullYear();
    for(let y=thisYear-50;y<=thisYear+50;y++){
      const opt=document.createElement("option");
      opt.value=y; opt.textContent=y;
      yearSelect.appendChild(opt);
    }
  }

  function render(){
    const y=viewDate.getFullYear();
    const m=viewDate.getMonth();
    monthSelect.value=m;
    yearSelect.value=y;

    daysGrid.innerHTML="";
    const first=new Date(y,m,1);
    const startDow=first.getDay();
    const total=daysInMonth(y,m);

    const today = new Date();
    today.setHours(0,0,0,0);

    for(let i=0;i<startDow;i++){
      const blank=document.createElement("div");
      blank.className="day muted";
      daysGrid.appendChild(blank);
    }

    for(let d=1;d<=total;d++){
      const date=new Date(y,m,d);
      const cell=document.createElement("div");
      cell.className="day";

      const weton=getWeton(date);
      const holiday=getHoliday(date);

      if (date.getDay() === 0){
        cell.classList.add("sunday");
      }

      if (isSameDate(date, today)){
        cell.classList.add("today");
      }

      if (holiday){
        cell.classList.add("holiday");
      }

      cell.innerHTML=`
        <div class="num">${d}</div>
        <div class="mini">${weton}</div>
        ${holiday ? `<div class="badge holiday">üéå ${holiday}</div>` : ""}
      `;

      cell.onclick=()=> showDetail(date);
      daysGrid.appendChild(cell);
    }
  }

  function showDetail(date){
    const chinaYear=getChineseYearInfo(date);
    const holiday=getHoliday(date);

    detail.innerHTML=`
      <b>${dino[date.getDay()]}, ${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}</b><br><br>

      üåô Hijriah: <b>${getHijri(date)}</b><br>
      üßø Jawa: <b>${getWeton(date)}</b><br><br>

      üßß Tahun Cina: <b>${chinaYear.shio}</b> | üåø Elemen: <b>${chinaYear.elemen}</b><br>
      üßæ Tanggal Cina: <b>${getChineseDateText(date)}</b><br><br>

      üéå Libur: <b>${holiday ? holiday : "Tidak ada"}</b>
    `;
  }

  // ===== Navigasi Bulan =====
  document.getElementById("prevBtn").onclick=()=>{
    viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()-1,1);
    render();
  };

  document.getElementById("nextBtn").onclick=()=>{
    viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth()+1,1);
    render();
  };

  // ===== Hari Ini (auto buka detail) =====
  document.getElementById("todayBtn").onclick=()=>{
    goToDate(new Date());
  };

  // ===== Select Bulan/Tahun =====
  monthSelect.onchange=()=>{
    viewDate=new Date(parseInt(yearSelect.value),parseInt(monthSelect.value),1);
    render();
  };

  yearSelect.onchange=()=>{
    viewDate=new Date(parseInt(yearSelect.value),parseInt(monthSelect.value),1);
    render();
  };

  // ===== Cari Tanggal =====
  function goToDate(date){
    const d = new Date(date);
    d.setHours(0,0,0,0);

    viewDate = new Date(d.getFullYear(), d.getMonth(), 1);
    render();
    showDetail(d);

    // biar datePicker ikut update
    datePicker.value = `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  }

  goDateBtn.onclick=()=>{
    if (!datePicker.value) return;
    const picked = new Date(datePicker.value + "T00:00:00");
    goToDate(picked);
  };

  // Enter di date input langsung cari
  datePicker.addEventListener("keydown", (e)=>{
    if (e.key === "Enter"){
      goDateBtn.click();
    }
  });

  // ===== INIT =====
  initSelectors();
  render();

  // Auto buka detail Hari Ini pas app dibuka
  goToDate(new Date());
</script>

</body>
</html>